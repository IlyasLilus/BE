<!DOCTYPE html>
<html>
<head>
    <style>
        #drag-items {
            position: absolute;
            bottom: 0;
            left: 0;
            display: flex;
            width: 200px; 
            height: 75px; 
            border: 1px solid black;
        }
        .draggable {
            width: 50px;
            height: 50px;
            margin: 10px;
        }
        #pc {
            background-image: url("image/desktop-computer.svg");
            background-size: cover;
        }
        #router {
            background-image: url("image/cisco-router-icon.webp");
            background-size:cover
        }
        #wire {
            background-image: url("image/cable.svg");
            background-size: cover;
        }
        #context-menu {
            display: none;
            position: absolute;
            width: 100px;
            background-color: #fff;
            border: 1px solid #ddd;
        }
        #context-menu button {
            all: unset;
            width: 100%;
            padding: 5px;
        }

        .draggable.clone {
            background-color: #ccc;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/interactjs@1.10.11/dist/interact.min.js"></script>
</head>
<body>

<div id="drag-items">
    <div id="pc" class="draggable"></div>
    <div id="router" class="draggable"></div>
    <div id="wire" class="draggable"></div>
</div>

<div id="context-menu">
    <button id="configurer">Configurer...</button>
    <button id="delete">Supprimer</button>
    <button id="cloner">Cloner</button>
</div>

<script>
    const contextMenu = document.getElementById('context-menu');
    const deleteButton = document.getElementById('delete');
    const clonerButton = document.getElementById('cloner');
    let selectedElement = null;

    interact('#drag-items').dropzone({
        accept: '.no-class', // Aucun élément n'est accepté
        overlap: 0.75,
        ondrop: function (event) {
            event.relatedTarget.style.transform = 'none';
            event.relatedTarget.setAttribute('data-x', 0);
            event.relatedTarget.setAttribute('data-y', 0);
        }
    });

    let selectedElements = [];
    interact('.draggable').on('tap', function (event) {
        if (event.target.id === 'wire') {
            selectedElements.push(event.target);
            event.target.style.backgroundColor = 'red'; // Change la couleur pour indiquer la sélection
        }
    });
    interact('.draggable')
        .draggable({
            inertia: true,
            autoScroll: true,
            onmove: dragMoveListener,
        })
        .on('doubletap', function (event) {
            selectedElement = event.target;
            contextMenu.style.display = 'block';
            contextMenu.style.left = `${event.pageX}px`;
            contextMenu.style.top = `${event.pageY}px`;
            event.preventDefault();
        });
    interact('#pc, #router').draggable({
        inertia: true,
        autoScroll: true,
        onmove: dragMoveListener,
        onend: function (event) {
            if (selectedElements.length === 2) {
                const ctx = document.querySelector('canvas').getContext('2d');
                const rect1 = selectedElements[0].getBoundingClientRect();
                const rect2 = selectedElements[1].getBoundingClientRect();
                ctx.beginPath();
                ctx.moveTo(rect1.left + rect1.width / 2, rect1.top + rect1.height / 2);
                ctx.lineTo(rect2.left + rect2.width / 2, rect2.top + rect2.height / 2);
                ctx.stroke();
                selectedElements = [];
            }
        }
    });
    deleteButton.addEventListener('click', function () {
        const clone = selectedElement.cloneNode();
        clone.style.transform = 'none';
        clone.setAttribute('data-x', 0);
        clone.setAttribute('data-y', 0);
        document.getElementById('drag-items').appendChild(clone);
        interact(clone)
            .draggable({
                inertia: true,
                autoScroll: true,
                onmove: dragMoveListener
            });
        selectedElement.parentNode.removeChild(selectedElement);
        contextMenu.style.display = 'none';
    });

    clonerButton.addEventListener('click', function () {
        const clone = selectedElement.cloneNode();
        clone.classList.add('clone');
        const x = selectedElement.getAttribute('data-x') || 0;
        const y = selectedElement.getAttribute('data-y') || 0;
        document.body.appendChild(clone);
        interact(clone)
            .draggable({
                inertia: true,
                autoScroll: true,
                onmove: dragMoveListener
            });
        selectedElement.parentNode.insertBefore(clone, selectedElement.nextSibling);
        contextMenu.style.display = 'none';
    });

    function dragMoveListener (event) {
        var target = event.target,
            x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx,
            y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;

        target.style.webkitTransform =
        target.style.transform =
            'translate(' + x + 'px, ' + y + 'px)';

        target.setAttribute('data-x', x);
        target.setAttribute('data-y', y);
    }
</script>

</body>
</html>